Bootstrap: docker
From: python:3.11-slim

%labels
    Author kk
    App ResimHTMLReport
    Description IPS report generator container

%environment
    export PYTHONUNBUFFERED=1
    export MPLBACKEND=Agg
    export PYTHONPATH=/opt/ips

%post
    set -eux
    apt-get update
    apt-get install -y --no-install-recommends \
        ca-certificates \
        gcc \
        g++ \
        libhdf5-dev \
        libgl1 \
        libglib2.0-0
    rm -rf /var/lib/apt/lists/*

    python -m pip install --upgrade pip setuptools wheel
    python -m pip install --no-cache-dir \
        numpy \
        pandas \
        h5py \
        plotly \
        matplotlib \
        pyzmq

    mkdir -p /opt/ips

%files
    . /opt/ips

%runscript
    cd /opt/ips
    exec python ResimHTMLReport.py "$@"

%test
    python -c "import numpy, pandas, h5py, plotly, matplotlib, zmq; print('Dependency check OK')"