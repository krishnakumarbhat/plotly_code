digraph org_det_class_diagram {
    rankdir=TB;
    bgcolor=white;
    fontname="Arial";
    fontsize=10;

    // Main function nodes
    node [shape=box, style="rounded,filled", fillcolor=lightblue, fontname="Arial Bold"];

    process_one_log [label="process_one_log()\nMain log processing function"];
    process_logs [label="process_logs()\nBatch processing controller"];
    plot_stats [label="plot_stats()\nVisualization generator"];
    plot_data_across_logs [label="plot_data_across_logs()\nCross-log analysis"];

    // Data structure nodes
    node [shape=ellipse, style=filled, fillcolor=lightgreen];

    session_vars [label="Session_Vars\nGlobal session state"];
    log_vars [label="Log_Vars\nPer-log variables"];
    config [label="config\nConfiguration settings"];
    constants [label="Constants\nSystem constants"];

    // External dependencies
    node [shape=diamond, style=filled, fillcolor=lightyellow];

    pandas [label="pandas\nData manipulation"];
    plotly [label="plotly\nVisualization"];
    logger [label="logger\nLogging system"];
    file_handling [label="file_handling\nFile operations"];

    // CSV data sources
    node [shape=parallelogram, style=filled, fillcolor=lightpink];

    veh_det_csv [label="Vehicle DET CSV"];
    sim_det_csv [label="Simulation DET CSV"];
    veh_rdd_csv [label="Vehicle RDD CSV"];
    sim_rdd_csv [label="Simulation RDD CSV"];
    veh_cdc_csv [label="Vehicle CDC CSV"];
    sim_cdc_csv [label="Simulation CDC CSV"];
    veh_vse_csv [label="Vehicle VSE CSV"];
    sim_vse_csv [label="Simulation VSE CSV"];

    // Output artifacts
    node [shape=folder, style=filled, fillcolor=lightgray];

    html_reports [label="HTML Reports"];
    debug_logs [label="Debug Logs"];
    plots [label="Statistical Plots"];

    // Relationships - Function to function
    edge [color=black, fontname="Arial", fontsize=8];

    process_logs -> process_one_log [label="calls for each log"];
    process_one_log -> plot_stats [label="generates visualizations"];
    process_logs -> plot_data_across_logs [label="creates summary plots"];

    // Function to data
    process_one_log -> session_vars [label="reads/writes"];
    process_one_log -> log_vars [label="reads/writes"];
    process_one_log -> config [label="uses"];
    process_one_log -> constants [label="uses"];

    // Function to external modules
    process_one_log -> pandas [label="DataFrame operations"];
    process_one_log -> logger [label="logging"];
    process_one_log -> file_handling [label="file I/O"];

    plot_stats -> plotly [label="creates plots"];
    plot_data_across_logs -> plotly [label="creates plots"];

    // Data flow from CSV files
    veh_det_csv -> process_one_log [label="reads"];
    sim_det_csv -> process_one_log [label="reads"];
    veh_rdd_csv -> process_one_log [label="reads"];
    sim_rdd_csv -> process_one_log [label="reads"];
    veh_cdc_csv -> process_one_log [label="reads"];
    sim_cdc_csv -> process_one_log [label="reads"];
    veh_vse_csv -> process_one_log [label="reads"];
    sim_vse_csv -> process_one_log [label="reads"];

    // Output generation
    process_one_log -> html_reports [label="generates"];
    process_one_log -> debug_logs [label="writes"];
    plot_stats -> plots [label="creates"];
    plot_data_across_logs -> plots [label="creates"];

    // Data dependencies
    config -> constants [style=dotted, label="configures"];
    session_vars -> log_vars [style=dotted, label="initializes"];
    logger -> debug_logs [label="writes to"];

    // Legend
    subgraph cluster_legend {
        label="Legend";
        style=dashed;
        color=gray;

        node [shape=box, fillcolor=white, style=""];

        "Core Functions" [shape=box, fillcolor=lightblue];
        "Data Variables" [shape=ellipse, fillcolor=lightgreen];
        "External Modules" [shape=diamond, fillcolor=lightyellow];
        "CSV Data Sources" [shape=parallelogram, fillcolor=lightpink];
        "Output Artifacts" [shape=folder, fillcolor=lightgray];
    }

    // Layout hints
    {rank=same; process_one_log; process_logs;}
    {rank=same; plot_stats; plot_data_across_logs;}
    {rank=same; session_vars; log_vars; config; constants;}
    {rank=same; pandas; plotly; logger; file_handling;}
    {rank=same; veh_det_csv; sim_det_csv; veh_rdd_csv; sim_rdd_csv;}
    {rank=same; veh_cdc_csv; sim_cdc_csv; veh_vse_csv; sim_vse_csv;}
    {rank=same; html_reports; debug_logs; plots;}
}
