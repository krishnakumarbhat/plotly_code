digraph detection_matching_kpi_class_diagram {
    rankdir=TB;
    bgcolor=white;
    fontname="Arial";
    fontsize=10;

    // Main class
    node [shape=box, style="rounded,filled", fillcolor=lightblue, fontname="Arial Bold"];

    detection_mapping_kpi [label="DetectionMappingKPIHDF\nMain KPI processing class"];

    // Key methods
    node [shape=box, style="rounded,filled", fillcolor=lightgreen];

    process_detection_matching [label="process_detection_matching()\nMain processing orchestrator"];
    process_rdd_matching [label="process_rdd_matching()\nRDD stream analysis"];
    process_af_detection_matching [label="process_af_detection_matching()\nAF detection analysis"];
    generate_html_report [label="generate_html_report()\nHTML report creation"];
    get_results [label="get_results()\nResults accessor"];

    // External dependencies
    node [shape=diamond, style=filled, fillcolor=lightyellow];

    kpi_data_model_storage [label="KPI_DataModelStorage\nHDF data container"];
    kpi_validation_rules [label="KPI_VALIDATION_RULES\nThreshold configuration"];
    logger [label="logging\nError tracking"];
    numpy [label="numpy\nArray operations"];
    plotly [label="plotly\nVisualization"];

    // Data structures
    node [shape=ellipse, style=filled, fillcolor=lightpink];

    kpi_results [label="KPI Results\nCalculated metrics"];
    html_content [label="HTML Content\nFormatted report"];
    thresholds [label="Thresholds\nValidation parameters"];

    // Factory function
    node [shape=box, style="rounded,filled", fillcolor=orange];

    process_detection_kpi [label="process_detection_kpi()\nFactory function"];

    // Relationships - Class to methods
    edge [color=black, fontname="Arial", fontsize=8];

    detection_mapping_kpi -> process_detection_matching [label="contains"];
    detection_mapping_kpi -> process_rdd_matching [label="contains"];
    detection_mapping_kpi -> process_af_detection_matching [label="contains"];
    detection_mapping_kpi -> generate_html_report [label="contains"];
    detection_mapping_kpi -> get_results [label="contains"];

    // Method dependencies
    process_detection_matching -> process_rdd_matching [label="calls"];
    process_detection_matching -> process_af_detection_matching [label="calls"];
    process_detection_matching -> generate_html_report [label="calls"];

    process_rdd_matching -> kpi_data_model_storage [label="uses"];
    process_af_detection_matching -> kpi_data_model_storage [label="uses"];
    generate_html_report -> kpi_results [label="uses"];

    // External dependencies
    detection_mapping_kpi -> kpi_data_model_storage [label="initializes with"];
    detection_mapping_kpi -> kpi_validation_rules [label="loads thresholds"];
    detection_mapping_kpi -> thresholds [label="configures"];

    process_detection_kpi -> detection_mapping_kpi [label="creates instance"];
    process_detection_kpi -> get_results [label="returns results"];

    // Data flow
    kpi_data_model_storage -> kpi_results [label="data source"];
    kpi_results -> html_content [label="input for"];
    html_content -> get_results [label="returns"];

    // Utility dependencies
    process_rdd_matching -> numpy [label="array operations"];
    process_af_detection_matching -> numpy [label="array operations"];
    generate_html_report -> plotly [label="HTML formatting"];
    logger -> process_detection_matching [label="error handling"];
    logger -> process_rdd_matching [label="error handling"];
    logger -> process_af_detection_matching [label="error handling"];
    logger -> generate_html_report [label="error handling"];

    // Data types
    node [shape=plaintext, fillcolor=white];
    "HDF Data" [shape=plaintext];
    "NumPy Arrays" [shape=plaintext];
    "Dictionary Results" [shape=plaintext];

    kpi_data_model_storage -> "HDF Data" [style=dotted];
    numpy -> "NumPy Arrays" [style=dotted];
    kpi_results -> "Dictionary Results" [style=dotted];

    // Layout hints
    {rank=same; detection_mapping_kpi; process_detection_kpi;}
    {rank=same; process_detection_matching; process_rdd_matching; process_af_detection_matching;}
    {rank=same; generate_html_report; get_results;}
    {rank=same; kpi_data_model_storage; kpi_validation_rules; logger;}
    {rank=same; kpi_results; html_content; thresholds;}
    {rank=same; numpy; plotly;}

    // Legend
    subgraph cluster_legend {
        label="Component Types";
        style=dashed;
        color=gray;

        node [shape=plaintext, fillcolor=white];

        "Main Class" [shape=plaintext];
        "Methods" [shape=plaintext];
        "External Dependencies" [shape=plaintext];
        "Data Structures" [shape=plaintext];
        "Factory Function" [shape=plaintext];
    }

    // Graph title
    labelloc="t";
    label="Detection Matching KPI Class Structure\nObject-Oriented HDF-based Design";
}
